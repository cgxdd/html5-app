<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title></title>
    <link rel="stylesheet" href="./css/index.css" />
  </head>
  <body>
    <div class="box-container">
      <div class="form">
        <input placeholder="MDC IP" class="input-item" id="IP" style="margin-bottom: 6px" />
        <button class="btn" id="submit">提 交1</button>
      </div>
    </div>

    <script type='text/javascript'>
      window.addEventListener('load', function() {
        const submitBtn = document.getElementById('submit')
        const ipDom = document.getElementById('IP')
        submitBtn.addEventListener('click', function() {
          const ipVal = ipDom.value
          if (!ipVal) {
            const selctIP = document.getElementById('scan').value
            if (selctIP) {
              vaildIP(selctIP)
            } else {
              return setErrorMsg(langKeys['请输入IP'])
            }
          }
          vaildIP(ipVal)
        })

        function vaildIP(val) {

          checkUrlAvailability(`http://${val}/landscape.html`).then(
            (isAvailable) => {
              if (isAvailable) {
                console.log(val)
                window.localStorage.setItem('cache', JSON.stringify(val))
                window.location.href = `http://${val}/landscape.html`
              }
            }
          )
        }
        async function checkUrlAvailability(url) {
          try {
            // 发送HEAD请求（比GET更轻量）
            const response = await fetch(url, {
              method: 'HEAD',
              mode: 'no-cors',
              cache: 'no-store',
              timeout: 8000, // 超时
            })

            // 状态码2xx或3xx表示成功
            return response.ok || response.status === 0
          } catch (error) {
            // 捕获网络错误、超时等异常
            console.error('检测失败:', error)
            return false
          }
        }
      })
    </script>
  </body>
</html>